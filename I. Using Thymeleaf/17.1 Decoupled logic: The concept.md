### 17.1 解耦的逻辑：概念

到目前为止，我们都用通常的模版来构建我们的杂货店——以属性的形式将逻辑插入我们的模版。

但是，Thymeleaf也允许我们从它的模版标记中完全解耦逻辑，允许在`HTML`和`XML`模版模式下创建`完全无逻辑的标记模版`。

大意就是将模版逻辑定义在一个分开的逻辑文件里（更准确地说，是一个逻辑资源，因为可以不是一个文件）。默认地，逻辑资源是一个额外的文件，和模版文件在同一个地方（比如，文件夹）。它们名字相同，但是逻辑资源文件的扩展名是`.th.xml`：
```
/templates
+->/home.html
+->/home.th.xml
```
因此，`home.html`文件可以是完全无逻辑的。看起来就像这样：
```html
<!DOCTYPE html>
<html>
  <body>
    <table id="usersTable">
      <tr>
        <td class="username">Jeremy Grapefruit</td>
        <td class="usertype">Normal User</td>
      </tr>
      <tr>
        <td class="username">Alice Watermelon</td>
        <td class="usertype">Administrator</td>
      </tr>
    </table>
  </body>
</html>
```
没有任何的Thymeleaf代码。这是一个连没有Thymeleaf或者模板知识的设计者也可以创建、编辑、理解的模板文件。或者，这是一段由某些外部系统提供的没有一点儿Thymeleaf挂钩的HTML。

现在，让我们通过创建额外的`home.th.xml`文件，把那个`home.html`模板转变为Thymeleaf模板。就像这样：
```xml
<?xml version="1.0"?>
<thlogic>
  <attr sel="#usersTable" th:remove="all-but-first">
    <attr sel="/tr[0]" th:each="user : ${users}">
      <attr sel="td.username" th:text="${user.name}" />
      <attr sel="td.usertype" th:text="#{|user.type.${user.type}|}" />
    </attr>
  </attr>
</thlogic>
```
Here we can see a lot of `<attr>` tags inside a `thlogic` block. Those `<attr>` tags perform attribute injection on nodes of the original template selected by means of their `sel` attributes, which contain Thymeleaf markup selectors (actually AttoParser markup selectors).

Also note that `<attr>` tags can be nested so that their selectors are appended. That `sel="/tr[0]"` above, for example, will be processed as `sel="#usersTable/tr[0]"`. And the selector for the user name `<td>` will be processed as `sel="#usersTable/tr[0]//td.username"`.

So once merged, both files seen above will be the same as:
```html
<!DOCTYPE html>
<html>
  <body>
    <table id="usersTable" th:remove="all-but-first">
      <tr th:each="user : ${users}">
        <td class="username" th:text="${user.name}">Jeremy Grapefruit</td>
        <td class="usertype" th:text="#{|user.type.${user.type}|}">Normal User</td>
      </tr>
      <tr>
        <td class="username">Alice Watermelon</td>
        <td class="usertype">Administrator</td>
      </tr>
    </table>
  </body>
</html>
```
This looks more familiar, and is indeed less verbose than creating two separate files. But the advantage of decoupled templates is that we can give for our templates total independence from Thymeleaf, and therefore better maintainability from the design standpoint.

Of course some contracts between designers or developers will still be needed – e.g. the fact that the users `<table>` will need an `id="usersTable"` –, but in many scenarios a pure-HTML template will be a much better communication artifact between design and development teams.
